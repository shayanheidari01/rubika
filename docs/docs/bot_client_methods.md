ฺฉูุงุณ `rubpy.BotClient` ฺฉ ฺฉูุงูุช ูุงููุฒูุงู ุง ุจู ุงุตุทูุงุญ `async` ุจุฑุง ุชุนุงูู ุจุง API ุฑุจุงุช ุฑูุจฺฉุง ุงุณุช. ุงู ูุณุชูุฏ ุชูุงู ูุชุฏูุงุ ูพุงุฑุงูุชุฑูุงุ ููุฏุงุฑ ุจุงุฒฺฏุดุชุ ุฑูุชุงุฑ ุฏุงุฎูุ ูฺฉุงุช ุนูู ู ูุซุงูโูุง ุฑุง ูพูุดุด ูโุฏูุฏ.

## ุณุงุฎุช ููููู
ุงู ฺฉูุงุณ ุดุงูู ูพุงุฑุงูุชุฑูุง ุจุฑุง ุชูุธู ุจุฑุฎ ุชูุธูุงุช ุงุณุช.
```py
client = BotClient(
    token="YOUR_BOT_TOKEN",
    rate_limit=0.5,          # ุชุฃุฎุฑ ุจู ุฏุฑุฎูุงุณุชโูุง (ุซุงูู)
    use_webhook=False        # True ุจุฑุง ูุจููฺฉ
)
```

### ูพุงุฑุงูุชุฑูุง ุณุงุฒูุฏู
| ูพุงุฑุงูุชุฑ | ููุน | ูพุดโูุฑุถ | ุชูุถุญุงุช |
| --- | --- | --- | --- |
| `token` | `str` | โ | ุชูฺฉู ุตุงุฏุฑุดุฏู ุชูุณุท ุฑูุจฺฉุง. |
| `rate_limit` | `float` | `0.5` | ุญุฏุงูู ูุงุตูู ุจู ุฏุฑุฎูุงุณุชโูุง ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุญุฏูุฏุช. |
| `use_webhook` | `bool` | `False` | ุชุนู ุญุงูุช ุงุฌุฑุง (ูุจโููฺฉ ุง ูพูููฺฏ). |
| `timeout` | `float` | `10.0` | ุชุงูโุงูุช ฺฉู ูุฑ ุฏุฑุฎูุงุณุช HTTP. |
| `connector` | `aiohttp.TCPConnector` | `None` | ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ฺฉุงูฺฉุดู ุจุง ุงูพูฺฉุดูโูุง ุฏฺฏุฑ. |
| `max_retries` | `int` | `3` | ุชุนุฏุงุฏ ุชูุงุด ูุฌุฏุฏ ุจุฑุง ุฎุทุงูุง ูุงุจู ุจุงุฒุงุจ. |
| `backoff_factor` | `float` | `1.0` | ุถุฑุจ ุชุตุงุนุฏ ุจุฑุง ุชุฃุฎุฑ ุจู ุชูุงุดโูุง ูุฌุฏุฏ. |
| `retry_statuses` | `Tuple[int,...]` | `(408,425,429,500,502,503,504)` | ฺฉุฏูุง HTTP ฺฉู ุจุงุนุซ ุชูุงุด ูุฌุฏุฏ ูโุดููุฏ. |
| `long_poll_timeout` | `float` | `30.0` | ุงูุฒูุฏู ุชุงูโุงูุช ุจู ุฏุฑุฎูุงุณุช (`getUpdates`) ุจุฑุง ูพูููฺฏ ุทููุงู. |
| `parse_mode` | `ParseMode \| str` | `ParseMode.MARKDOWN` | ุญุงูุช ูพุดโูุฑุถ ูุงูุจโุจูุฏ ูุชู. |
| `fallback_urls` | `Sequence[str]` | `("https://botapi.rubika.ir/v3/{}/",)` | URLูุง ุฌุงฺฏุฒู ุฏุฑ ุตูุฑุช ูุทุน ุขุฏุฑุณ ุงุตู. |
| `ignore_timeout` | `bool` | `False` | ุงุฏุงููู ุชูุงุด ุฏุฑ ุฎุทุงูุง Timeout. |
| `plugins` | `Sequence[str]` | `None` | ููุฑุณุช ูพูุงฺฏูโูุง ูุนุงู ุดููุฏูู ุฎูุฏฺฉุงุฑ. |
| `auto_enable_plugins` | `bool` | `False` | ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ูพูุงฺฏูโูุง ููฺฏุงู `start`. |
| `plugin_entry_point_group` | `str` | `"rubpy.plugins"` | ฺฏุฑูู entry point ุจุฑุง ฺฉุดู ูพูุงฺฏูโูุง. |
| `plugin_manager_class` | `Type[PluginManager]` | `PluginManager` | ฺฉูุงุณ ูุฏุฑุช ูพูุงฺฏู. |

**ูฺฉุชู:** ุงุฒ ฺฉุงูุชฺฉุณุชโููุฌุฑูุง `async with BotClient(...)` ู `with BotClient(...)` ูุฒ ูโุชูุงู ุจุฑุง ูุฏุฑุช ุฎูุฏฺฉุงุฑ `start/stop` ุงุณุชูุงุฏู ฺฉุฑุฏ.

---
## ฺุฑุฎูู ุญุงุช

### ุดุฑูุน ุจุงุช
ูุชุฏ: `start`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช                                                                                 |
| ------- | --: | --------------------------------------------------------------------------------------- |
| โ       |   โ | ุดุฑูุน ู ุขูุงุฏู ุณุงุฒ `BotClient` ุจุฑุง ุงุฑุชุจุงุท ุจุง API ุจุงุช ุฑูุจฺฉุง |

**ุดุฑุญ ฺฉูุชุงู:** ุขูุงุฏูโุณุงุฒ ุณุดู HTTP ุจุฑุง ุงุฑุณุงู ุฏุฑุฎูุงุณุชโูุง.

**ุจุงุฒฺฏุดุช:** `None` (async)

### ูุฏุฑุช ูพูุงฺฏูโูุง

| ูุชุฏ | ุชูุถุญุงุช |
| --- | --- |
| `enable_plugins(identifiers: Optional[Sequence[str]] = None)` | ูพูุงฺฏูโูุง ูุดุฎุตโุดุฏู ุง ููุฑุณุช ูพุดโูุฑุถู ุณุงุฒูุฏู ุฑุง ูุนุงู ูโฺฉูุฏ. ุฎุฑูุฌ: `List[Plugin]`. |
| `disable_plugins(identifiers: Optional[Sequence[str]] = None)` | ุงฺฏุฑ ุดูุงุณู ูุฏูุฏ ุชูุงู ูพูุงฺฏูโูุง ูุนุงู ุบุฑูุนุงู ูโุดููุฏ. |
| `register_plugin(plugin_cls, name=None)` | ูพูุงฺฏู ุฌุฏุฏ ุฑุง ุจู ูุฏุฑ ุฏุงุฎู ุซุจุช ูโฺฉูุฏ ู ูุงู ฺฉุชุง ุจุงุฒูโฺฏุฑุฏุงูุฏ. |

**ูฺฉุชู:** ุงู API ุจุง ุณุณุชู `entry points` ูพุงุชูู ุณุงุฒฺฏุงุฑ ุงุณุชุ ุจุง ูุนุงู ุจูุฏู `auto_enable_plugins` ูพูุงฺฏูโูุง ููฺฏุงู `start` ูุนุงู ูโุดููุฏ.

### ูุฏุฑุช ฺฉูพุฏ ฺุช
- `edit_chat_keypad`: ุจุฑุง ุชุบุฑ ฺฉุจูุฑุฏ ููุงุด ฺุช.
- `middleware` + `process_update`: ุงูฺฉุงู ุณุงุฎุช ฺฉุจูุฑุฏูุง ุชุนุงูู ูพฺุฏู ุฑุง ูุฑุงูู ูโฺฉูุฏ.

### ูุฑูุชโุฏู ูุชู ู ูุชุงุฏุชุง
- `_apply_text_formatting`: ุจุฑุงุณุงุณ `parse_mode` ูุชู ุฑุง ุจู Markdown ุฏุงุฎู ุชุจุฏู ฺฉุฑุฏู ู `metadata` ุฑุง (ุฏุฑ ุตูุฑุช ุงุฑุณุงู `Metadata` ุงุฒ rubpy.bot.models) ุจู payload ุงุถุงูู ูโฺฉูุฏ.
- ุญุงูุชโูุง ูุนุชุจุฑ: `ParseMode.MARKDOWN`, `ParseMode.HTML`, ุง `None` (ูุชู ุฎุงู).

---
### ุบุฑูุนุงู ฺฉุฑุฏู ุจุงุช
ูุชุฏ: `stop`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช                                                                     |
| ------- | --: | --------------------------------------------------------------------------- |
| โ       |   โ | ุขูุงุฏู ุณุงุฒ ุจุฑุง ูุชููู ฺฉุฑุฏู |

**ุดุฑุญ ฺฉูุชุงู:** ูุชููู ฺฉุฑุฏู client ู ุจุณุชู ููุงุจุน.

**ุจุงุฒฺฏุดุช:** `None` (async)

---
### ุงุฌุฑุง ุจุงุช
ูุชุฏ: `run`

| ูพุงุฑุงูุชุฑ       |             ููุน | ุชูุถุญุงุช                                 |
| ------------- | --------------: | --------------------------------------- |
| `webhook_url` | `Optional[str]` | ุงฺฏุฑ ุชุนู ุดูุฏุ ูุจโููฺฉ ูุนุงู ูโุดูุฏ       |
| `path`        | `Optional[str]` | ูุณุฑ ูุจโููฺฉ (ูพุดโูุฑุถ `/webhook`)        |
| `host`        |           `str` | ูุฒุจุงู ุจุฑุง ูุจโุณุฑูุฑ (ูพุดโูุฑุถ `0.0.0.0`) |
| `port`        |           `int` | ูพูุฑุช ูุจโุณุฑูุฑ (ูพุดโูุฑุถ `8080`)           |

**ุดุฑุญ ฺฉูุชุงู:** ูุชุฏ ุงุฌุฑุง ุงุตู:

* ุงฺฏุฑ `webhook_url` ุงุฑุงุฆู ุดุฏู ุจุงุดุฏ: ฺฉ ุณุฑูุฑ `aiohttp.web` ุจุฑุง ุฏุฑุงูุช ูุจโููฺฉโูุง ุฑุงูโุงูุฏุงุฒ ู endpointโูุง ุจู API ุซุจุช ูโุดููุฏ.
* ุฏุฑ ุบุฑ ุงู ุตูุฑุช: ูุงุฑุฏ ุญูููู ูพูููฺฏ (`updater`) ุดุฏู ู ุจูโุตูุฑุช ุฏูุฑูโุง `getUpdates` ูโุฎูุงูุฏ ู `process_update` ุงุฌุฑุง ูโุดูุฏ.

**ุจุงุฒฺฏุดุช:** `None` (async)

**ูฺฉุงุช:** `run` ุฎูุฏุด `start()` ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ ุฏุฑ ุญุงูุช ูุจโููฺฉ ุจุงุฏ HTTPS ู ุงุญุงูุงู ูฺฉุงูุฒู ุงุนุชุจุงุฑุณูุฌ ุงุถุงูู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ.

### ฺฉุงูุชฺฉุณุชโููุฌุฑ
- `__aenter__` / `__aexit__`: ุงุฌุฑุง ุฎูุฏฺฉุงุฑ `start/stop` ุฏุฑ ูุญุทโูุง async.
- `__enter__` / `__exit__`: ูุณุฎูู ููฺฏุงู ุจุฑุง ุงุณฺฉุฑูพุชโูุง ุณุงุฏู.

### ูุฏุฑุช ุณุดู ู ูุญุฏูุฏุช ุณุฑุนุช
- `_ensure_session`: ุงุฌุงุฏ `aiohttp.ClientSession` ุจุง ูุฏุฑ ฺฉุงุฑุจุฑ ุฑูุจฺฉุง ู ุชูุธูุงุช ูุญุฏูุฏุช ุงุชุตุงู.
- `_rate_limit_delay`: ูุจู ุงุฒ ูุฑ ุฏุฑุฎูุงุณุชุ ุงุฎุชูุงู ุฒูุงู ุขุฎุฑู ุฏุฑุฎูุงุณุช ุฑุง ุจุฑุฑุณ ฺฉุฑุฏู ู ุฏุฑ ุตูุฑุช ูุงุฒ `await asyncio.sleep` ุงูุฌุงู ูโุฏูุฏ.
- `_make_request`: ุชููุฏุงุช ฺฉุงูู ุจุฑุง ุชูุงุด ูุฌุฏุฏุ ุณูฺ ุฎูุฏฺฉุงุฑ ุจู `BASE_URL` ู `FALLBACK_URLS` ู ุชุจุฏู ุฎุทุงูุง ุจู `APIException`.

---
## ุงุทูุงุนุงุช ูพุงูโุง ุจุงุช

### ุฏุฑุงูุช ุงุทูุงุนุงุช ุจุงุช
ูุชุฏ: `get_me`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช                                 |
| ------- | --: | --------------------------------------- |
| โ       |   โ | ุฏุฑุงูุช ุงุทูุงุนุงุช ุจุงุช |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุฑุงูุช ุงุทูุงุนุงุช ุจุงุช.

**ุจุงุฒฺฏุดุช:** `Bot` (async)

**ูุซุงู:**

```py
bot = await client.get_me()
```

---
## ุงุฑุณุงู ูพุงูโูุง ู ูุญุชูุง

### ุงุฑุณุงู ูพุงู ูุชู
ูุชุฏ: `send_message`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ููุตุฏ            |
| `text`                 |                `str` | ูุชู ูพุงู               |
| `chat_keypad`          |   `Optional[Keypad]` | ฺฉูพุฏ ฺุช                |
| `inline_keypad`        |   `Optional[Keypad]` | ฺฉูพุฏ ุงููุงู           |
| `disable_notification` |               `bool` | ุบุฑูุนุงู ฺฉุฑุฏู ุงุนูุงูุ (ูพุดูุฑุถ False)  |
| `reply_to_message_id`  |      `Optional[str]` | ุฏุฑ ุฌูุงุจู ูพุงููุ |
| `chat_keypad_type`     | `ChatKeypadTypeEnum` | ููุน ฺฉูพุฏ ฺุช            |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุณุงู ูพุงู ูุง ูุชูุ ุจู ููุฑุงู ูพุดุชุจุงู ุงุฒ Keypad ู InlineKeypad.

**ุจุงุฒฺฏุดุช:** `MessageId` (async)

**ูุซุงู:**

```py
mid = await client.send_message("chat_id", "ุณูุงู!", chat_keypad=keypad, chat_keypad_type=ChatKeypadTypeEnum.SIMPLE)
```

---
### ุงุฑุณุงู ุงุณุชฺฉุฑ
ูุชุฏ: `send_sticker`

| ูพุงุฑุงูุชุฑ        |   ููุน | ุชูุถุญุงุช              |
| -------------- | ----: | -------------------- |
| `chat_id`      | `str` | ุดูุงุณู ููุตุฏ           |
| `sticker_id`   | `str` | ุดูุงุณูู ุงุณุชฺฉุฑ        |
| ุณุงุฑ ูพุงุฑุงูุชุฑูุง |     โ | ูุดุงุจู `send_message` |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุณุงู ุงุณุชฺฉุฑ ุจู ฺุช.

**ุจุงุฒฺฏุดุช:** `MessageId` (async)

---
### ุงุฑุณุงู ูุงู
ูุชุฏ: `send_file`

| ูพุงุฑุงูุชุฑ        |                                                     ููุน | ุชูุถุญุงุช                          |
| -------------- | ------------------------------------------------------: | -------------------------------- |
| `chat_id`      |                                                   `str` | ุดูุงุณู ููุตุฏ                       |
| `file`         |                            `Optional[Union[str, Path]]` | ูุณุฑ ูุงู ุฏุฑ ุญุงูุธู ุจุฑุง ุขูพููุฏ (ุงุฎุชุงุฑ)   |
| `file_id`      |                                         `Optional[str]` | ุดูุงุณูู ูุงู ุงฺฏุฑ ุงุฒ ูุจู ุขูพููุฏ ุดุฏู |
| `text`         |                                         `Optional[str]` | ุจู ุนููุงู ฺฉูพุดู ูุงู                       |
| `file_name`    |                                         `Optional[str]` | ูุงู ูุงู ููฺฏุงู ุขูพููุฏ             |
| `type`         | `Literal["File","Image","Voice","Music","Gif","Video"]` | ููุน ูุงู                         |
| ุณุงุฑ ูพุงุฑุงูุชุฑูุง |                                                       โ | ูุดุงุจู `send_message`             |

**ุดุฑุญ ฺฉูุชุงู:** ุงฺฏุฑ ูุณุฑ ูุงู ุจู ูพุงุฑุงูุชุฑ `file` ุฏุงุฏู ุดูุฏุ ุงุจุชุฏุง ูุงู ุขูพููุฏ ุดุฏู ู ุณูพุณ ุงุฑุณุงู ูโุดูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุงฺฏุฑ `file_id` ุจู ูพุงุฑุงูุชุฑ ูุฑุจูุทู ุฏุงุฏู ุดูุฏุ ูุงู ูุณุชููุงุ ุจุฏูู ูุงุฒ ุจู ุขูพููุฏ ูุฌุฏุฏ ุงุฑุณุงู ูโุดูุฏ.

**ุจุงุฒฺฏุดุช:** `MessageId` (async) โ `file_id` ูุฒ ุฏุฑ ูุชุฌู ูุฑุงุฑ ูโฺฏุฑุฏ.

**ูุซุงู:**

```py
mid = await client.send_file("chat_id", file="/tmp/photo.jpg", type="Image", text="ุนฺฉุณ")
```

---
### ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูุงู
ูุชุฏ: `request_send_file`

| ูพุงุฑุงูุชุฑ |            ููุน | ุชูุถุญุงุช       |
| ------- | -------------: | ------------- |
| `type`  | `Literal[...]` | ููุน ูุงู ูุฌุงุฒ |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุณุงู ุฏุฑุฎูุงุณุช ุขูพููุฏ ูุงู ุจู ุณุฑูุฑ ุฑูุจฺฉุง ู ุฏุฑุงูุช `upload_url` ุฏุฑ ุตูุฑุช ูุฌุงุฒ ุจูุฏู `type` ุจุฑุง ุขูพููุฏ ูุงู ุฏุฑ ุณุฑูุฑ ุฑูุจฺฉุง.

**ุจุงุฒฺฏุดุช:** `str` โ `upload_url`

**ุฎุทุง:** ุงฺฏุฑ `type` ูุงูุนุชุจุฑ ุจุงุดุฏ `ValueError` ุฎูุงูุฏ ุฏุงุฏ.

---
### ุจุงุฑฺฏุฐุงุฑ ูุงู
ูุชุฏ: `upload_file`

| ูพุงุฑุงูุชุฑ     |   ููุน | ุชูุถุญุงุช               |
| ----------- | ----: | --------------------- |
| `url`       | `str` | ุขุฏุฑุณ ุขูพููุฏ ุฏุฑุงูุชโุดุฏู |
| `file_name` | `str` | ูุงู ูุงู      |
| `file_path` | `str` | ูุณุฑ ูุญู ูุงู        |

**ุดุฑุญ ฺฉูุชุงู:** ุขูพููุฏ ูุงู ุฏุฑ ุณุฑูุฑ ุฑูุจฺฉุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุขุฏุฑุณ ฺฉู ุชูุณุท ูุชุฏ `request_send_file` ุฏุฑุงูุช ฺฉุฑุฏูโุงู.

**ุจุงุฒฺฏุดุช:** `str` โ `file_id`

---
### ุฏุฑุงูุช ูุงู
ูุชุฏ: `get_file`

| ูพุงุฑุงูุชุฑ   |   ููุน | ุชูุถุญุงุช     |
| --------- | ----: | ----------- |
| `file_id` | `str` | ุดูุงุณูู ูุงู |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุฑุงูุช ุขุฏุฑุณ ุฏุงูููุฏ ูุงู (`download_url`) ุจุง ุงุณุชูุงุฏู ุงุฒ `file_id`

**ุจุงุฒฺฏุดุช:** `str` โ `download_url`

---
### ุจุงุฑฺฏุฑ ูุงู
ูุชุฏ: `download_file`

| ูพุงุฑุงูุชุฑ      |                                  ููุน | ุชูุถุญุงุช                              |
| ------------ | -----------------------------------: | ------------------------------------ |
| `file_id`    |                                `str` | ุดูุงุณูู ูุงู                          |
| `save_as`    |                      `Optional[str]` | ูุณุฑ ุฐุฎุฑู (ุงฺฏุฑ `as_bytes=False`)    |
| `progress`   | `Optional[Callable[[int,int],None]]` | ฺฉุงูโุจฺฉ ูพุดุฑูุช (downloaded, total)    |
| `chunk_size` |                                `int` | ุงูุฏุงุฒูู chunk (ุจุงุช)                 |
| `as_bytes`   |                               `bool` | ุงฺฏุฑ Trueุ ูุญุชูุง ุจุงุช ุจุฑฺฏุฑุฏุงูุฏู ุดูุฏ |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุงูููุฏ ูุงู ุงุฒ ุณุฑูุฑ ุฑูุจฺฉุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุขุฏุฑุณ ุฏุงูููุฏ ูุงู. ุงฺฏุฑ `as_bytes` ุจุฑุงุจุฑ `True` ุจุงุดุฏุ ูุญุชูุง ฺฉุงูู ูุงู ุฑุง ุจู ุตูุฑุช ฺฉุงูู ุจุฑูโฺฏุฑุฏุงูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ูุงู ุฑุง ุฏุฑ ุญุงูุธู ุฐุฎุฑู ูโฺฉูุฏ ู ูุณุฑ ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.

**ุจุงุฒฺฏุดุช:** `Union[str, bytes, None]` (async)

**ุฎุทุงูุง:** ุงฺฏุฑ `get_file` ุดฺฉุณุช ุจุฎูุฑุฏ `ValueError` ูพุฑุชุงุจ ูโุดูุฏุ ุงฺฏุฑ ุฏุงูููุฏ ูุงูููู ุจุงุดุฏ `Exception` ูพุฑุชุงุจ ูโุดูุฏ.

---
## ูพุงูโูุง ุชุนุงูู

### ุงุฑุณุงู ูุธุฑุณูุฌ
ูุชุฏ: `send_poll`

| ูพุงุฑุงูุชุฑ    |         ููุน | ุชูุถุญุงุช    |
| ---------- | ----------: | ---------- |
| `chat_id`  |       `str` | ุดูุงุณู ููุตุฏ |
| `question` |       `str` | ูุชู ุณูุงู   |
| `options`  | `List[str]` | ฺฏุฒููโูุง   |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุณุงู ูุธุฑุณูุฌ.

**ุจุงุฒฺฏุดุช:** `MessageId` (async)

---
### ุงุฑุณุงู ูููุนุช ูฺฉุงู
ูุชุฏ: `send_location`

| ูพุงุฑุงูุชุฑ        |                ููุน | ุชูุถุญุงุช              |
| -------------- | -----------------: | -------------------- |
| `chat_id`      |              `str` | ุดูุงุณู ููุตุฏ           |
| `latitude`     | `Union[str,float]` | ุนุฑุถ ุฌุบุฑุงูุง        |
| `longitude`    | `Union[str,float]` | ุทูู ุฌุบุฑุงูุง        |
| ุณุงุฑ ูพุงุฑุงูุชุฑูุง |                  โ | ูุดุงุจู `send_message` |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุณุงู ูููุนุช ูฺฉุงู.

**ุจุงุฒฺฏุดุช:** `MessageId` (async)

---
### ุงุฑุณุงู ูุฎุงุทุจ
ูุชุฏ: `send_contact`

| ูพุงุฑุงูุชุฑ        |   ููุน | ุชูุถุญุงุช              |
| -------------- | ----: | -------------------- |
| `chat_id`      | `str` | ุดูุงุณู ููุตุฏ           |
| `first_name`   | `str` | ูุงู ูุฎุงุทุจ            |
| `last_name`    | `str` | ูุงู ุฎุงููุงุฏฺฏ         |
| `phone_number` | `str` | ุดูุงุฑู ุชููู           |
| ุณุงุฑ ูพุงุฑุงูุชุฑูุง |     โ | ูุดุงุจู `send_message` |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุณุงู ุงุทูุงุนุงุช ุชูุงุณ.

**ุจุงุฒฺฏุดุช:** `MessageId` (async)

---
## ุฎูุงูุฏู ุขูพุฏุชโูุง ู ูพูููฺฏ

### ุฏุฑุงูุช ุขูพุฏุช ูุง
ูุชุฏ: `get_updates`

| ูพุงุฑุงูุชุฑ     |   ููุน | ุชูุถุญุงุช                                   |
| ----------- | ----: | ----------------------------------------- |
| `limit`     | `int` | ุชุนุฏุงุฏ ุขูพุฏุชโูุง ุจุฑุง ุฏุฑุฎูุงุณุช (ูพุดโูุฑุถ 100) |
| `offset_id` | `str` | ุขูุณุช (ุงุฎุชุงุฑ)                            |

**ุดุฑุญ ฺฉูุชุงู:** ูุฑุงุฎูุงู ุณุงุฏูู `getUpdates` ู ุชููุฏ ูุณุช ุงุฒ ุงุดุงุก `Update`/`InlineMessage` (ูุณุฎูู ููููู ุญุฏุงูู ูพุงุฏูโุณุงุฒ ุดุฏู).

**ุจุงุฒฺฏุดุช:** `List[Union[Update, InlineMessage]]` (async)

---
### ุญูููู ูพูููฺฏ ูพุดุฑูุชู
ูุชุฏ: `updater`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช |
| --- | --- | --- |
| `limit` | `int` | ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุขูพุฏุช ุฏุฑ ูุฑ ุฏุฑุฎูุงุณุช. |
| `offset_id` | `str` | ุขุฏ ุงุฏุงููู ุขูพุฏุชโูุงุ ุฏุฑ ุตูุฑุช ุนุฏู ููุฏุงุฑ ุงุฒ `next_offset_id` ุฏุงุฎู ุงุณุชูุงุฏู ูโุดูุฏ. |
| `poll_timeout` | `float` | ุงูุฒูุฏู ุชุงูโุงูุช ุจู ุฏุฑุฎูุงุณุช (`getUpdates`) ุจุฑุง ูพูููฺฏ ุทููุงู. |

**ุดุฑุญ ฺฉูุชุงู:** wrapper ููุดููุฏ ุจุฑุง `getUpdates` ฺฉู ููุงุฑุฏ ูุฏู ุฑุง ุญุฐู ฺฉุฑุฏูุ ุขูพุฏุชโูุง ุญุฐูโุดุฏู ุฑุง ูุงุฏุฏู ูโฺฏุฑุฏ ู `self.next_offset_id` ุฑุง ูฺฏู ูโุฏุงุฑุฏ.

**ุจุงุฒฺฏุดุช:** `List[Union[Update, InlineMessage]]` (async) โ ูุฑ ุขูพุฏุช ุจุง `client` ุชุฒุฑูโุดุฏู ุจุงุฒูโฺฏุฑุฏุฏ ุชุง ุจุชูุงู ูุชุฏูุง ูพุงุณุฎโุฏู ูุซู `update.reply` ุฑุง ุตุฏุง ุฒุฏ.

### ูพุฑุฏุงุฒุด ุขูพุฏุช
ูุชุฏูุง: `process_update`, `_dispatch_update`, `_filters_pass`

1. `process_update`: ุฒูุฌุฑูู middlewareูุง ุฑุง ุงุฌุฑุง ู ุณูพุณ `_dispatch_update` ุฑุง ุตุฏุง ูโุฒูุฏ.
2. `_dispatch_update`: deduplication ุจุฑ ุงุณุงุณ `message_id`ุ ุงุฌุฑุง ูุฎุณุชู ููุฏูุฑ ฺฉู ุชูุงู ููุชุฑูุง ุฑุง ูพุงุณ ฺฉูุฏ ู ูพุดุชุจุงู ุงุฒ ููุฏูุฑูุง sync/async.
3. `_filters_pass`: ูููููโุณุงุฒ ุฎูุฏฺฉุงุฑ ููุชุฑูุง ฺฉู ฺฉูุงุณ ูพุงุณ ุฏุงุฏู ุดุฏูโุงูุฏ ู ุงุฌุฑุง `await filter.check(update)`.

### ุฏุฑุงูุช ูุจโููฺฉ
ูุชุฏ: `handle_webhook`

- ุชููุง ุฏุฑุฎูุงุณุชโูุง `POST` ุฑุง ูโูพุฐุฑุฏ ู JSON ุฑุง ุจู `Update` ุง `InlineMessage` ุชุจุฏู ูโฺฉูุฏ.
- ุจุฑุง ูุฑ ุขูพุฏุช `asyncio.create_task(self.process_update(update))` ูุฑุงุฎูุงู ูโุดูุฏ ุชุง ูพุงุณุฎ ุณุฑุน ุงุฑุณุงู ฺฏุฑุฏุฏ.
- ูพุงุณุฎ ูููู: `{"status": "OK"}`.

**ูฺฉุชู:** `run` ููฺฏุงู ูุนุงู ุจูุฏู ูุจโููฺฉ endpointูุง `ReceiveUpdate`, `ReceiveInlineMessage`, ... ุฑุง ุจุง ุขุฏุฑุณ ุฌุฏุฏ ุซุจุช ูโฺฉูุฏ.

---
## ุงุทูุงุนุงุช ฺุช ู ููุฑูุงุฑุฏ

### ุฏุฑุงูุช ุงุทูุงุนุงุช ฺฏูุชฺฏู
ูุชุฏ: `get_chat`

| ูพุงุฑุงูุชุฑ   |   ููุน | ุชูุถุญุงุช   |
| --------- | ----: | --------- |
| `chat_id` | `str` | ุดูุงุณูู ฺุช |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุฑุงูุช ุงุทูุงุนุงุช ฺฏูุชฺฏู.

**ุจุงุฒฺฏุดุช:** `Chat` (async)

---
### ุฏุฑุงูุช ูุฏุฑุงู ฺุช
ูุชุฏ: `get_chat_administrators`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ฺฏูุชฺฏู            |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุฑุงูุช ูุณุช ูุฏุฑุงู ฺฏุฑูู. (ุฏุฑ ุตูุฑุช ฺฉู ุจุงุช ุฏุฑ ฺฏุฑูู ููุฑุฏ ูุธุฑ ูุฏุฑ ุจุงุดุฏ)

**ุจุงุฒฺฏุดุช:** `Dict[str, Any]` โ ูพุงุณุฎ ุฎุงู API ุดุงูู ููุฑุณุช ูุฏุฑุงู.

**ูุซุงู:**

```py
admins = await client.get_chat_administrators("chat_id")
```

---
### ุฏุฑุงูุช ุชุนุฏุงุฏ ุงุนุถุง ฺฏุฑูู
ูุชุฏ: `get_chat_member_count`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ฺฏูุชฺฏู            |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุฑุงูุช ุชุนุฏุงุฏ ููุจุฑูุง ฺฉ ฺฏุฑููุ ุฏุฑ ุตูุฑุช ฺฉู ุจุงุช ุฏุฑ ฺฏุฑูู ุงุฏูู ุจุงุดุฏ.

**ุจุงุฒฺฏุดุช:** `int` โ ุชุนุฏุงุฏ ุงุนุถุง.

**ูุซุงู:**

```py
member_count = await client.get_chat_member_count("chat_id")
```

---
### ุญุฐู ุนุถู ุงุฒ ฺฏุฑูู
ูุชุฏ: `ban_chat_member`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ฺฏูุชฺฏู            |
| `user_id`              |                `str` | ุดูุงุณูู ฺฉุงุฑุจุฑ ููุฑุฏ ูุธุฑ            |

**ุดุฑุญ ฺฉูุชุงู:** ุญุฐู ฺฉ ุนุถู ุงุฒ ฺฏุฑูู.

**ุจุงุฒฺฏุดุช:** `bool` โ ุขุง ุญุฐู ุงูุฌุงู ุดุฏุ

**ูุซุงู:**

```py
await client.ban_chat_member("chat_id", "user_id")
```

---
### ุญุฐู ุนุถู ุงุฒ ูุณุช ุณุงู
ูุชุฏ: `unban_chat_member`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ฺฏูุชฺฏู            |
| `user_id`              |                `str` | ุดูุงุณูู ฺฉุงุฑุจุฑ ููุฑุฏ ูุธุฑ            |

**ุดุฑุญ ฺฉูุชุงู:** ุญุฐู ฺฉ ุนุถู ุงุฒ ูุณุช ุณุงู ฺฏุฑูู.

**ุจุงุฒฺฏุดุช:** `bool` โ ุขุง ุญุฐู ุงูุฌุงู ุดุฏุ

**ูุซุงู:**

```py
await client.unban_chat_member("chat_id", "user_id")
```

---
### ุฏุฑุงูุช ุงุทูุงุนุงุช ุนุถู
ูุชุฏ: `get_chat_member`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ฺฏุฑูู ุง ฺฉุงูุงู            |
| `user_id`              |                `str` | ุดูุงุณูู ฺฉุงุฑุจุฑ ููุฑุฏ ูุธุฑ            |

**ุดุฑุญ ฺฉูุชุงู:** ุฏุฑุงูุช ุงุทูุงุนุงุช ุนุถู ุงุฒ ฺฏุฑูู ุง ฺฉุงูุงู ุฏุฑ ุตูุฑุช ุนุถู ุจูุฏู.

**ุจุงุฒฺฏุดุช:** `ChatMember` โ ุงุทูุงุนุงุช ุนุถู.

**ูุซุงู:**

```py
await client.get_chat_member("chat_id", "user_id")
```

---
### ุงุฑุชูุง ุนุถู
ูุชุฏ: `promote_chat_member`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณูู ฺฏุฑูู ุง ฺฉุงูุงู            |
| `user_id`              |                `str` | ุดูุงุณูู ฺฉุงุฑุจุฑ ููุฑุฏ ูุธุฑ            |

**ุดุฑุญ ฺฉูุชุงู:** ุงุฑุชูุง ุงุฒ ุนุถู ุจู ูุฏุฑ ุฏุฑ ฺฏุฑูู ุง ฺฉุงูุงู.

**ุจุงุฒฺฏุดุช:** `bool` โ ุขุง ุงุฑุชูุง ุงูุฌุงู ุดุฏุ

**ูุซุงู:**

```py
await client.promote_chat_member("chat_id", "user_id")
```

---
### ุชูุธู ุฏุณุชุฑุณ ฺฉุงุฑุจุฑุงู ุฏุฑ ฺฏูุชฺฏู
ูุชุฏ: `set_chat_permissions`

| ูพุงุฑุงูุชุฑ                |                  ููุน | ุชูุถุญุงุช                |
| ---------------------- | -------------------: | ---------------------- |
| `chat_id`              |                `str` | ุดูุงุณู ฺฏุฑูู           |

**ุดุฑุญ ฺฉูุชุงู:** ุชูุธู ุฏุณุชุฑุณ ูุง ฺฉุงุฑุจุฑุงู ุฏุฑ ฺฏูุชฺฏู.

**ุจุงุฒฺฏุดุช:** `bool` โ ุขุง ุชูุธู ุฏุณุชุฑุณ ุงูุฌุงู ุดุฏุ

**ูุซุงู:**

```py
await client.set_chat_permissions("chat_id", ...)
```

---
## ุซุจุช ููุฏูุฑูุง ู ููุชุฑูุง

### ุฏฺฉูุฑุงุชูุฑ ููุฏูุฑ ุขูพุฏุช
ูุชุฏ: `on_update`

| ูพุงุฑุงูุชุฑ    |         ููุน | ุชูุถุญุงุช                              |
| ---------- | ----------: | ------------------------------------ |
| `*filters` | `Filter...` | ูุฌููุนูโุง ุงุฒ ููุชุฑูุง (ฺฉูุงุณ ุง ููููู) |

**ุดุฑุญ ฺฉูุชุงู:** ุฏฺฉูุฑุงุชูุฑ on_update ฺฉ ุฏฺฉูุฑุงุชูุฑ ุณุทุญ ุจุงูุง ุจุฑุง ุซุจุช ููุฏูุฑูุง ุจู ููุฑุงู ููุชุฑูุง ุงุณุช. ุดูุง ูุชูุงูุฏ ููุฏูุฑูุง `async` ู `sync` ุฑุง ููุฒูุงู ุฏุฑ ฺฉูุงุฑ ฺฉุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ.

**ูุซุงู:**

```py
@client.on_update()
async def echo(client, update):
    if update.new_message and update.new_message.text:
        await update.reply("pong")
```

---
### ุงูุฒูุฏู ููุฏูุฑ
ูุชุฏ: `add_handler`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช |
| --- | --- | --- |
| `handler` | `Callable` | ุชุงุจุน ุจุง ุงูุถุง `(bot, update)` |
| `*filters` | `Filter...` | ููุชุฑูุง ุงุฌุฑุง ูุดุงุจู `on_update` |

**ุจุงุฒฺฏุดุช:** `str` โ ฺฉูุฏ ฺฉุชุง ุจุฑุง ุญุฐู ุจุนุฏ.

**ูุซุงู:**

```py
async def hello_world(client, update):
    if update.new_message and update.new_message.text:
        await update.reply("Hello, World!")

client.add_handler(hello_world, filters.commands("hello"))
my_handler = client.add_handler(hello_world)
```

---
### ุญุฐู ููุฏูุฑ
ูุชุฏ: `remove_handler`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช |
| --- | --- | --- |
| `handler_key` | `str` | ุฎุฑูุฌ `add_handler` ุง `on_update`. |
| `handler` | `Callable` | (ุงุฎุชุงุฑ) ุญุฐู ููุท ฺฉ ุชุงุจุน ุฎุงุต ุฒุฑ ููุงู ฺฉูุฏ. |

**ุจุงุฒฺฏุดุช:** `bool` โ ุขุง ููุฏูุฑ ุญุฐู ุดุฏุ

**ูุซุงู:**

```py
my_handler = client.add_handler(hello_world)
client.remove_handler(my_handler)
```

---
### ุจู ูุญุถ ุดุฑูุน
ูุชุฏ: `on_start`

**ูุซุงู:**

```py
@app.on_start()
async def greet(bot):
    print("Bot started...")
    print(await bot.get_me())
```

---
### ุจู ูุญุถ ุฎุงููุด ุดุฏู
ูุชุฏ: `on_shutdown`

**ูุซุงู:**

```py
@app.on_shutdown()
async def bye(bot):
    print("๐ Bot is shutting down!")
```

---
### ูุงูโุงูุฒุงุฑ (Middleware)

ูุชุฏ: `middleware`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช                                                                                 |
| ------- | --: | --------------------------------------------------------------------------------------- |
| โ       |   โ | ุงู ูุชุฏ ุฏฺฉูุฑุงุชูุฑ ุงุณุชุ ุชุงุจุน ุฑุง ูโฺฏุฑุฏ ฺฉู ูุจู ุงุฒ ุฑุณุฏู ูุฑ ุขูพุฏุช ุจู ููุฏูุฑูุง ุงุฌุฑุง ูโุดูุฏ. |

**ุดุฑุญ ฺฉูุชุงู:**
ูุงูโุงูุฒุงุฑูุง ูุงูโูุง ูุณุชูุฏ ฺฉู ุฑู ุฌุฑุงู ุขูพุฏุชโูุง ูุฑุงุฑ ูโฺฏุฑูุฏ. ูุฑ ุขูพุฏุช ูุจู ุงุฒ ุฑุณุฏู ุจู ููุฏูุฑูุง ุงุฒ ุฒูุฌุฑูู middlewareูุง ุนุจูุฑ ูโฺฉูุฏ. ูุฑ middleware ุณู ุขุฑฺฏููุงู ุฏุฑุงูุช ูโฺฉูุฏ:

```py
async def middleware(bot, update, call_next):
    ...
    await call_next()   # ุงุฏุงูู ูุณุฑ ุจู middleware ุจุนุฏ ุง ููุฏูุฑ ุงุตู
```

* `bot`: ูููููโ BotClient
* `update`: ุดุก Update ุง InlineMessage
* `call_next`: ุชุงุจุน ุจุฑุง ุงุฑุณุงู ฺฉูุชุฑู ุจู middleware ุจุนุฏ ุง ุฏุฑ ููุงุช ููุฏูุฑ

ุงฺฏุฑ ฺฉ middleware `await call_next()` ุฑุง ุตุฏุง ูุฒูุฏุ ุฒูุฌุฑู ูุชููู ูโุดูุฏ ู ููุฏูุฑูุง ุงุฌุฑุง ููโุดููุฏ (ุจุฑุง ูุณุฏูุฏ ฺฉุฑุฏู ุง ููุชุฑ ฺฉุฑุฏู ููุฏ ุงุณุช).

**ุจุงุฒฺฏุดุช:** `None` (async)

---
## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ

### ูุซุงู ฑ โ ุงุฑุณุงู ูพุงู ุณุงุฏู

```py
client = BotClient("MY_TOKEN")
await client.start()
mid = await client.send_message("chat_id", "ุณูุงูุ ุฑุจุงุช ุขุฒูุงุด!")
await client.stop()
```

### ูุซุงู ฒ โ ุขูพููุฏ ู ุงุฑุณุงู ุนฺฉุณ

```py
mid = await client.send_file("chat_id", file="/tmp/photo.jpg", type="Image", text="ุนฺฉุณ ุชุณุช")
```

### ูุซุงู ณ โ ุซุจุช ููุฏูุฑ ู ุงุฌุฑุง ูพูููฺฏ

```py
@client.on_update()
async def echo(client, update):
    if update.new_message and update.new_message.text:
        await update.reply("ุฏุฑุงูุช ุดุฏ: " + update.new_message.text)

await client.run()  # ุงุฌุฑุง ูพูููฺฏ (ุง use webhook ุงฺฏุฑ webhook_url ุฏุงุฏู ุจุงุดุฏ)
```

### ูุซุงู ด โ ุงุฌุฑุง ุจุง ูุจโููฺฉ

```py
# ูุฑุถ: ุณุฑูุณ ุดูุง ุฏุฑ https://example.com ุงุณุช
await client.run(webhook_url="https://example.com", path="/rubika/webhook", host="0.0.0.0", port=8080)
```

### ูุซุงู ต โ ุงุณุชูุงุฏู ุงุฒ ูพูุงฺฏู ู middleware

```py
client = BotClient("TOKEN", auto_enable_plugins=True, plugins=["echo"])

@client.middleware()
async def logger(bot, update, call_next):
    print("Update arrived", update.type)
    await call_next()

await client.run()
```