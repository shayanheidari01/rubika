ูุงฺูู `rubpy.bot.filters` ูุฌููุนูโุง ุงุฒ ููุชุฑูุง ุฑุง ุจุฑุง ูุฏุฑุช ู ููุชุฑ ฺฉุฑุฏู ุขูพุฏุชโูุง ุฑุจุงุช ูุฑุงูู ูโฺฉูุฏ.
ูุฑ ููุชุฑ ฺฉูุงุณ/ุชุงุจุน ุงุณุช ฺฉู ูุชุฏ `check` (async) ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ ู ููฺฏุงู ุฏุฑุงูุช ุขูพุฏุช ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ููุฏูุฑ ุจุงุฏ ุงุฌุฑุง ุดูุฏ ุง ุฎุฑ.

## ุงุณุชูุงุฏูู ฺฉู

```python
from rubpy import BotClient
from rubpy.bot import filters

bot = BotClient("your_bot_token")

@bot.on_update(filters.text("hello"))
async def handle_hello(c, update):
    await c.send_message(update.chat_id, "Hello!")
```

---

## ุทุฑุงุญ ฺฉู ููุชุฑูุง

* ูููู ููุชุฑูุง **ุขุณูฺฉ** ูุณุชูุฏ ู ูุชุฏ `check(update)` ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉููุฏ.
* ฺฉ ููุชุฑ ููฺฏุงู ุงุณุชูุงุฏู ูโุชูุงูุฏ ุจูโุตูุฑุช ฺฉูุงุณ (ูููููโุณุงุฒ ุฏุงุฎู) ุง ูููููู ุขูุงุฏู ุจู ุฏฺฉูุฑุงุชูุฑ ูพุงุณ ุฏุงุฏู ุดูุฏ.
* ฺูุฏ ููุชุฑ ุฑุง ูโุชูุงู ุจูโุตูุฑุช positional ุจู `@on_update(...)` ูพุงุณ ุฏุงุฏ ุชุง ููฺฏ ุจุง ูู ุจุฑุฑุณ ุดููุฏ (AND ููุทู).

## `text`

| ูพุงุฑุงูุชุฑ       |             ููุน | ุชูุถุญุงุช                                                   |
| ------------- | --------------: | --------------------------------------------------------- |
| `pattern`     | `Optional[str]` | ูุชู ุง ุงูฺฏู regex (ุงฺฏุฑ None ุนู ูุฑ ูุชู)                |
| `regex`       |          `bool` | ุขุง `pattern` ุจูโุตูุฑุช regex ุชูุณุฑ ุดูุฏุ (ูพุดโูุฑุถ False)    |
| `ignore_case` |          `bool` | ูุงุฏุฏู ฺฏุฑูุชู ุจุฒุฑฺฏ/ฺฉูฺฺฉ ุจูุฏู ุญุฑูู ุฏุฑ ููุงุณู (ูพุดโูุฑุถ True) |

**ุดุฑุญ ฺฉูุชุงู:** ููุชุฑ ุจุฑ ุงุณุงุณ ูุชู ูพุงูุ ุงุฒ ุชุทุจู ุฏูู ุง regex ูพุดุชุจุงู ูโฺฉูุฏ.

**ุจุงุฒฺฏุดุช:** ูููููโ ููุชุฑ (ูุงุจู ุงุณุชูุงุฏู ุฏุฑ `@on_update`)

**ูุซุงูโูุง:**

```python
@bot.on_update(filters.text)  # ูุฑ ูุชู
async def any_text(c, u): ...

@bot.on_update(filters.text("hello"))  # ุชุทุจู ุฏูู
async def exact(c, u): ...

@bot.on_update(filters.text(r"^/start", regex=True))  # regex
async def start_cmd(c, u): ...
```

**ูฺฉุชู:** ุงฺฏุฑ `pattern` ุฎุงู ุจุงุดุฏ ู `regex=False`ุ ููุชุฑ ููุท ฺฺฉ ูโฺฉูุฏ ฺฉู ูพุงู ูุชู ูุฌูุฏ ุฏุงุฑุฏ.

---

## `commands`

| ูพุงุฑุงูุชุฑ    |   ููุน | ุชูุถุญุงุช      |                         |
| ---------- | ----: | ------------ | ----------------------- |
| `commands` | \`str | List\[str]\` | ูุงูู ูุฑูุงู(ูุง) ุจุฏูู `/` |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ุจุง ุฏุณุชูุฑ ูุดุฎุต ุดุฑูุน ูโุดููุฏ (ูุซูุงู `/start`).

**ูุซุงู:**

```python
@bot.on_update(filters.commands("start"))
async def start(c, u): ...

@bot.on_update(filters.commands(["help","about"]))
async def help_or_about(c, u): ...
```

**ูฺฉุชู:** ุงู ููุชุฑ ูุนูููุงู ูุชู ูพุงู ุฑุง ุจู ุตูุฑุช tokenized ุจุฑุฑุณ ูโฺฉูุฏ ุชุง ูุฑูุงู ุฏุฑ ุงุจุชุฏุง ูุชู ุจุงุดุฏ.

---

## `update_type`

| ูพุงุฑุงูุชุฑ |   ููุน | ุชูุถุญุงุช      |                                                         |
| ------- | ----: | ------------ | ------------------------------------------------------- |
| `types` | \`str | List\[str]\` | ฺฉ ุง ฺูุฏ ููุฏุงุฑ ุงุฒ `UpdateTypeEnum` ุง ูุนุงุฏู ุฑุดุชูโุง ุขู |

**ุดุฑุญ ฺฉูุชุงู:** ููุชุฑ ุจุฑุงุณุงุณ ููุน ุขูพุฏุช (ูุซูุงู `NewMessage`, `UpdatedMessage`, `InlineMessage`).

**ูุซุงู:**

```python
@bot.on_update(filters.update_type("NewMessage"))
async def newmsg(c, u): ...

@bot.on_update(filters.update_type(["NewMessage","InlineMessage"]))
async def multi(c, u): ...
```

---

## `private`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงุณ ฺฉุฑุฏู ุชููุง ุฒูุงู ฺฉู ุขูพุฏุช ุงุฒ ฺฉ ฺุช ุฎุตูุต (user) ุจุงุดุฏ.

**ูุซุงู:**

```python
@bot.on_update(filters.private)
async def priv(c,u): ...
```

---

## `group`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงุณ ฺฉุฑุฏู ุชููุง ุฒูุงู ฺฉู ูพุงู ุงุฒ ฺฏุฑูู ุจุงุดุฏ.

**ูุซุงู:**

```python
@bot.on_update(filters.group)
async def grp(c,u): ...
```

---

## `channel`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงุณ ฺฉุฑุฏู ุชููุง ุฒูุงู ฺฉู ูพุงู ุงุฒ ฺฉุงูุงู ุจุงุดุฏ.

**ูุซุงู:**

```python
@bot.on_update(filters.channel)
async def chl(c,u): ...
```

---

## `bot`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ูุฑุณุชูุฏูโุดุงู ุงุฒ ููุน `Bot` ุงุณุช.

**ูุซุงู:**

```python
@bot.on_update(filters.bot)
async def from_bot(c,u): ...
```

---

## `chat`

| ูพุงุฑุงูุชุฑ    |   ููุน | ุชูุถุญุงุช      |                                             |
| ---------- | ----: | ------------ | ------------------------------------------- |
| `chat_ids` | \`str | List\[str]\` | ฺฉ ุดูุงุณู ุง ูุณุช ุดูุงุณูโูุง ฺุช ฺฉู ุงุฌุงุฒู ุฏุงุฑุฏ |

**ุดุฑุญ ฺฉูุชุงู:** ูุญุฏูุฏ ฺฉุฑุฏู ุงุฌุฑุง ููุฏูุฑ ุจู ฺฉ ุง ฺูุฏ `chat_id` ูุดุฎุต.

**ูุซุงู:**

```python
@bot.on_update(filters.chat("b0_test_chat"))
async def test(c,u): ...

@bot.on_update(filters.chat(["b0_admin","b0_mod"]))
async def admin_mod(c,u): ...
```

---

## `button`

| ูพุงุฑุงูุชุฑ   |    ููุน | ุชูุถุญุงุช                                         |
| --------- | -----: | ----------------------------------------------- |
| `pattern` |  `str` | ูุชู ุง ุงูฺฏู ุดูุงุณู ุฏฺฉูู                         |
| `regex`   | `bool` | ุขุง pattern ุจูโุตูุฑุช regex ุจุงุดุฏุ (ูพุดโูุฑุถ False) |

**ุดุฑุญ ฺฉูุชุงู:** ููุชุฑ ฺฉูฺฉ ุฑู ุฏฺฉููโูุง (callback / button id) โ ุชุทุจู ุฏูู ุง regex.

**ูุซุงู:**

```python
@bot.on_update(filters.button("btn_123"))
async def b123(c,u): ...

@bot.on_update(filters.button(r"btn_\d+", regex=True))
async def numbered(c,u): ...
```

---

## `forward`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงุณ ูโุดูุฏ ุงฺฏุฑ ูพุงู ุงุฒ ุฌุง ููุฑูุงุฑุฏ ุดุฏู ุจุงุดุฏ (`forwarded_from` ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ).

**ูุซุงู:**

```python
@bot.on_update(filters.forward)
async def fwd(c,u): ...
```

---

## `replied`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ุจุฑุฑุณ ุงูฺฉู ุขุง ูพุงู ุฑู ฺฉ ูพุงู ุฏฺฏุฑ ุฑูพูุง ุดุฏู ุง ุฎุฑ.

**ูุซุงู:**

```python
@bot.on_update(filters.replied)
async def is_replieds(c,u): ...
```

---

## `is_edited`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ููุชุฑ ูพุงูโูุง ูุฑุงุดโุดุฏู (`is_edited == True` ุง ููุน `UpdatedMessage`).

**ูุซุงู:**

```python
@bot.on_update(filters.is_edited)
async def edited(c,u): ...
```

---

## `sender_type`

| ูพุงุฑุงูุชุฑ |   ููุน | ุชูุถุญุงุช      |                                             |
| ------- | ----: | ------------ | ------------------------------------------- |
| `types` | \`str | List\[str]\` | ููุน/ุงููุงุน ูุฑุณุชูุฏู (ูุซูุงู `"User"`, `"Bot"`) |

**ุดุฑุญ ฺฉูุชุงู:** ููุชุฑ ุจุฑ ุงุณุงุณ `sender_type` ูพุงู.

**ูุซุงู:**

```python
@bot.on_update(filters.sender_type("User"))
async def from_user(c,u): ...

@bot.on_update(filters.sender_type(["Bot","Channel"]))
async def bot_or_channel(c,u): ...
```

---

## `has_aux_data`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงุณ ูโุดูุฏ ุงฺฏุฑ ูพุงู `aux_data` ุฏุงุดุชู ุจุงุดุฏ (ููุฏ ุจุฑุง ุฏฺฉููโูุง/payloadูุง).

**ูุซุงู:**

```python
@bot.on_update(filters.has_aux_data)
async def aux(c,u): ...
```

---

## `file`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ูพูุณุช ูุงู ุฏุงุฑูุฏ (`message.file`).

**ูุซุงู:**

```python
@bot.on_update(filters.file)
async def new_file(c,u): ...
```

---

## `location`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ููฺฉุดู ุฏุงุฑูุฏ (`message.location` ุง `live_location`).

**ูุซุงู:**

```python
@bot.on_update(filters.location)
async def loc(c,u): ...
```

---

## `sticker`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ุงุณุชฺฉุฑ ุฏุงุฑูุฏ (`message.sticker`).

**ูุซุงู:**

```python
@bot.on_update(filters.sticker)
async def stk(c,u): ...
```

---

## `contact_message`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ุดุงูู ฺฉุงูุชฺฉุช ูุณุชูุฏ (`message.contact_message`).

**ูุซุงู:**

```python
@bot.on_update(filters.contact_message)
async def contact(c,u): ...
```

---

## `poll`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ูุธุฑุณูุฌ (poll) ุฏุงุฑูุฏ (`message.poll`).

**ูุซุงู:**

```python
@bot.on_update(filters.poll)
async def poll_msg(c,u): ...
```

---

## `live_location`

| ูพุงุฑุงูุชุฑ | ููุน | ุชูุถุญุงุช      |
| ------- | --: | ------------ |
| โ       |   โ | ุจุฏูู ูพุงุฑุงูุชุฑ |

**ุดุฑุญ ฺฉูุชุงู:** ูพุงูโูุง ฺฉู ูููุนุช ุฒูุฏู (`live_location`) ุฏุงุฑูุฏ.

**ูุซุงู:**

```python
@bot.on_update(filters.live_location)
async def live_loc(c,u): ...
```

---

## ุชุฑฺฉุจ ููุชุฑูุง (Multi filters)

ฺูุฏ ููุชุฑ ุฑุง ูโุชูุงู ฺฉูุงุฑ ูู ูุฑุงุฑ ุฏุงุฏุ ููู ุจุงุฏ ูพุงุณ ุดููุฏ (ููุทู AND):

```python
@bot.on_update(filters.private, filters.commands('start'))
async def welcome(c,u):
    await u.reply("Welcome to private start!")
```

### ุงุณุชูุงุฏู ูพุดุฑูุชู:
ุชุฑฺฉุจ ููุชุฑูุง OR ู AND.

```python
@bot.on_update(filters.commands('hello') & (filters.private | filters.group))
async def hello_world(c,u):
    await u.reply("Hello, World!")
```

---

# ููุชุฑ `states`

ููุชุฑ `states` ฺฉ ฺฉูุงุณ ุจุฑุง ูุฏุฑุช **ูุถุนุช ูฺฉุงููู (conversation state)** ุฏุฑ ุฑุจุงุช ุงุณุช.
ุงู ููุชุฑ ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ุจูโุฑูุฒุฑุณุงู (`update`) ูุฑุจูุท ุจู **ฺฉ state ูุดุฎุต** ุงุณุช ุง ููุ ุจุฏูู ูุงุฒ ุจู ฺฉุชุงุจุฎุงูู ุง ูุฏุฑุชโฺฉููุฏู ุฎุงุฑุฌ.

---

## ๐ ูุซุงูโูุง ุงุณุชูุงุฏู

### 1. ุชุนู ูุถุนุช ุจุนุฏ ุงุฒ ุฏุณุชูุฑ `/start`

```python
@bot.on_message(text("/start"))
async def start_handler(client, message):
    await message.reply("ุณูุงู! ูุทูุงู ูุงู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ.")
    states.set(message.user_id, "waiting_for_name")
```

---

### 2. ูพุฑุฏุงุฒุด ูุฑูุฏ ุจุฑ ุงุณุงุณ ูุถุนุช

```python
@bot.on_message(states("waiting_for_name"))
async def name_handler(client, message):
    await message.reply(f"ุฎูุดุจุฎุชู {message.text}! ุณู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ.")
    states.set(message.user_id, "waiting_for_age")
```

---

### 3. ุงูุชูุงู ุจู ูุถุนุชโูุง

```python
@bot.on_message(states("waiting_for_age"))
async def age_handler(client, message):
    await message.reply(f"ุนุงู! ุดูุง {message.text} ุณุงูู ูุณุชุฏ.")
    states.clear(message.user_id)  # ูพุงุงู ุฌุฑุงู ูฺฉุงููู
```

---

### 4. ุจุฑุฑุณ ูุถุนุช ูุนู ฺฉุงุฑุจุฑ

```python
user_state = states.get(message.user_id)
if user_state == "waiting_for_age":
    await message.reply("ุดูุง ูููุฒ ุฏุฑ ุญุงูุช ูุงุฑุฏ ฺฉุฑุฏู ุณู ูุณุชุฏ.")
```

---

### ๐งฉ ูฺฉุงุช ฺฉูุฏ

* ุงุฒ **ุฑุดุชูโูุง ฺฉูุชุงู ู ฺฏูุง** ุจุฑุง ูุถุนุชโูุง ุงุณุชูุงุฏู ฺฉูุฏ (`"waiting_for_email"`, `"awaiting_confirmation"`).
* ููุดู ุจุนุฏ ุงุฒ ูพุงุงู ุฌุฑุงู ูฺฉุงูููุ ูุถุนุช ุฑุง ุจุง `clear` ูพุงฺฉ ฺฉูุฏ ุชุง ุญุงูุธู ุงุถุงูู ูุตุฑู ูุดูุฏ.
* ุจุฑุง ูุฏุฑุช ุฌุฑุงูโูุง ูพฺุฏูุ ูโุชูุงูุฏ ูุถุนุชโูุง ุฑุง ฺฏุฑููโุจูุฏ ฺฉูุฏ (`"reg:name"`, `"reg:age"`, `"reg:done"`).

---

## ูฺฉุงุช ูพุงุฏูโุณุงุฒ ู ุจูุชุฑู ุชูุฑูโูุง

* ูุชุฏ `check(update)` ุฏุฑ ูุฑ ููุชุฑ **ุขุณูฺฉ** ุจุงุดุฏ ุชุง ุจุชูุงูุฏ ููุงุจุน IO (ูุซูุงู ุฏุชุงุจุณ ุง ุดุจฺฉู) ุฑุง ูุฒ ฺฺฉ ฺฉูุฏ.
* ุจุฑุง ููุชุฑูุง Regexุ ุงุณุชูุงุฏู ุงุฒ ฺฉุงููพุงู ฺฉุฑุฏู ุงูฺฏู (`re.compile`) ุฏุฑ ุณุงุฒูุฏูู ููุชุฑ ุจุงุนุซ ุงูุฒุงุด ฺฉุงุฑุง ูโุดูุฏ.
* ููฺฏุงู ุจุฑุฑุณ ูุชูุ ููุดู `None` ุจูุฏู ููุฏูุง ุฑุง ฺฺฉ ฺฉูุฏ ุชุง ุงุฒ `AttributeError` ุฌููฺฏุฑ ุดูุฏ.
* ุงฺฏุฑ ูุงุฒ ุจู ููุชุฑ stateful ุฏุงุฑุฏ (ูุซูุงู ูุญุฏูุฏุช ูุฑุฎ ุจุฑุง ฺฉุงุฑุจุฑ)ุ ูพุงุฏูโุณุงุฒ ุฑุง ุจู ฺฏูููโุง ุงูุฌุงู ุฏูุฏ ฺฉู thread-safe ุง compatible ุจุง async ุจุงุดุฏ (ูุซูุงู ุงุณุชูุงุฏู ุงุฒ async locks ุง external store ูุซู Redis).
* ุจุฑุง ุชุณุชุ ููุชุฑูุง ุฑุง ุจูโุตูุฑุช ุฌุฏุงฺฏุงูู unit-test ฺฉูุฏ ุจุง ูููููโูุง `Update`/`InlineMessage` ูุตููุน.

---

## FAQ

**ฑ) ุขุง ููุชุฑูุง ูโุชูุงููุฏ async I/O ุงูุฌุงู ุฏููุฏุ**
ุจูู โ `check` ุขุณูฺฉ ุงุณุช ู ูโุชูุงูุฏ ุฏุฑุฎูุงุณุชโูุง ุฏุชุงุจุณ ุง ุดุจฺฉูโุง ุฏุงุดุชู ุจุงุดุฏ.

**ฒ) ุชุฑุชุจ ุจุฑุฑุณ ููุชุฑูุง ฺฺฏููู ุงุณุชุ**
ููุชุฑูุง ุจู ุชุฑุชุจ ูุฑุงุฑฺฏุฑ ุฏุฑ ุฏฺฉูุฑุงุชูุฑ ุจุฑุฑุณ ูโุดููุฏุ ุงููู ููุชุฑ ฺฉู `False` ุจุฑฺฏุฑุฏุงูุฏ ุงุฒ ุงุฌุฑุง ููุฏูุฑ ุฌููฺฏุฑ ูโฺฉูุฏ.

**ณ) ุขุง OR ุชุฑฺฉุจ ููุชุฑูุง ูพุดุชุจุงู ูโุดูุฏุ**
ุฏุฑ ูุณุฎูู ูพุงู ุชุฑฺฉุจ ุจู ุตูุฑุช AND ุงุณุช. ุงฺฏุฑ ูุงุฒู ุงุณุชุ ูโุชูุงูุฏ ฺฉ helper ุจููุณุฏ ฺฉู OR ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ ุง ููุชุฑ ุฌุฏุฏ ุจุณุงุฒุฏ.